(("undefined"!==typeof self?self:this)["webpackJsonpvcd_node_driver_0_2_10"]=("undefined"!==typeof self?self:this)["webpackJsonpvcd_node_driver_0_2_10"]||[]).push([[1],{"00a5":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",[e.$fetchState.pending?t("Loading",{attrs:{delayed:!0}}):e._e(),e.errors.length?t("div",e._l(e.errors,(function(a,i){return t("div",{key:i},[t("Banner",{attrs:{color:"error",label:e.stringify(a)}})],1)})),0):e._e(),t("div",[t("div",{staticClass:"vcd-config"},[t("div",{staticClass:"title"},[e._v(" vCloud Director Configuration ")]),e.authenticating?t("div",{staticClass:"loading"},[t("i",{staticClass:"icon-spinner icon-spin icon-lg"}),t("span",[e._v(" Authenticating with the vCloud Director server ... ")])]):e._e()]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{label:"Catalog",options:e.catalogs.options,disabled:!e.catalogs.enabled||e.busy,loading:e.catalogs.busy,searchable:!1},model:{value:e.catalogs.selected,callback:function(t){e.$set(e.catalogs,"selected",t)},expression:"catalogs.selected"}})],1),t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{label:"vApp template",options:e.catalogitem.options,disabled:!e.catalogs.enabled&&!e.catalogitem.enabled,loading:e.catalogitem.busy||e.catalogs.busy||e.busy,searchable:!1},model:{value:e.catalogitem.selected,callback:function(t){e.$set(e.catalogitem,"selected",t)},expression:"catalogitem.selected"}})],1)]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{label:"Network",options:e.orgvdcnetwork.options,disabled:!e.orgvdcnetwork.enabled||e.busy,loading:e.orgvdcnetwork.busy,searchable:!1},model:{value:e.orgvdcnetwork.selected,callback:function(t){e.$set(e.orgvdcnetwork,"selected",t)},expression:"orgvdcnetwork.selected"}})],1),t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{label:"Network Adapter",options:e.networkadaptertype.options,disabled:!e.catalogitem.enabled&&!e.networkadaptertype.enabled&&!e.vAppVms.enabled&&!e.operatingSystem.enabled,loading:e.networkadaptertype.busy||e.catalogitem.busy||e.vAppVms.busy||e.operatingSystem.busy||e.busy,searchable:!1},model:{value:e.networkadaptertype.selected,callback:function(t){e.$set(e.networkadaptertype,"selected",t)},expression:"networkadaptertype.selected"}})],1)]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{label:"IP Address Allocation Mode",options:e.ipaddressallocationmode.options,disabled:e.busy,searchable:!1},model:{value:e.ipaddressallocationmode.selected,callback:function(t){e.$set(e.ipaddressallocationmode,"selected",t)},expression:"ipaddressallocationmode.selected"}})],1)]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{label:"Storage",options:e.storprofile.options,disabled:!e.storprofile.enabled||e.busy,loading:e.storprofile.busy,searchable:!1},model:{value:e.storprofile.selected,callback:function(t){e.$set(e.storprofile,"selected",t)},expression:"storprofile.selected"}})],1)]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("UnitInput",{attrs:{mode:e.mode,disabled:e.busy,required:!0,"output-as":"string",label:"CPU",suffix:"Cores"},model:{value:e.cpuCount,callback:function(t){e.cpuCount=t},expression:"cpuCount"}})],1)]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("UnitInput",{attrs:{mode:e.mode,disabled:e.busy,required:!0,"output-as":"string",label:"Memory",suffix:"MB"},model:{value:e.memorySize,callback:function(t){e.memorySize=t},expression:"memorySize"}})],1)]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("UnitInput",{attrs:{mode:e.mode,disabled:e.busy,required:!0,"output-as":"string",label:"Disk size",suffix:"MB"},model:{value:e.diskSize,callback:function(t){e.diskSize=t},expression:"diskSize"}})],1)]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("LabeledInput",{attrs:{mode:e.mode,disabled:e.busy,required:!0,label:"SSH User"},model:{value:e.sshUser,callback:function(t){e.sshUser=t},expression:"sshUser"}})],1)]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("LabeledInput",{attrs:{mode:e.mode,disabled:e.busy,label:"Cloud-init based User data before everything"},model:{value:e.initData,callback:function(t){e.initData=t},expression:"initData"}})],1),t("div",{staticClass:"col span-6"},[t("LabeledInput",{attrs:{mode:e.mode,disabled:e.busy,label:"Cloud-init based User data"},model:{value:e.userData,callback:function(t){e.userData=t},expression:"userData"}})],1)]),t("br"),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("LabeledInput",{attrs:{mode:e.mode,disabled:e.busy,label:"Edge Gateway (Default is <vdc>)"},model:{value:e.edgegateway,callback:function(t){e.edgegateway=t},expression:"edgegateway"}})],1),t("div",{staticClass:"col span-6"},[t("LabeledInput",{attrs:{mode:e.mode,disabled:e.busy,label:"Virtual Data Center Edge Gateway"},model:{value:e.vdcedgegateway,callback:function(t){e.vdcedgegateway=t},expression:"vdcedgegateway"}})],1)]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("LabeledInput",{attrs:{mode:e.mode,disabled:e.busy,label:"Public IP to use"},model:{value:e.publicip,callback:function(t){e.publicip=t},expression:"publicip"}})],1),t("div",{staticClass:"col span-6"},[t("Checkbox",{attrs:{mode:e.mode,disabled:e.busy,label:"Insecure api"},model:{value:e.insecure,callback:function(t){e.insecure=t},expression:"insecure"}})],1)])])],1)},s=[],o=a("15ca"),l=a("6418"),r=a("305c"),n=a("466b"),d=a("4978"),c=a("1032"),u=a("8e93"),p=a("907c"),v=a("3e9d"),h=a("da25"),g=a("7713");function m(){return{options:[],selected:null,busy:!1,enabled:!1}}var b={components:{Banner:l["a"],Loading:o["a"],LabeledInput:u["a"],UnitInput:d["a"],LabeledSelect:n["a"],Checkbox:c["a"]},mixins:[r["a"]],props:{uuid:{type:String,required:!0},cluster:{type:Object,default:()=>({})},credentialId:{type:String,required:!0},disabled:{type:Boolean,default:!1},busy:{type:Boolean,default:!1},provider:{type:String,required:!0}},async fetch(){if(this.errors=[],!this.credentialId)return;if(this.mode===h["p"])return void this.initForViewMode();try{this.credential=await this.$store.dispatch("rancher/find",{type:p["p"].CLOUD_CREDENTIAL,id:this.credentialId})}catch(t){this.credential=null}try{const e=this.credentialId.replace(":","/"),t=await this.$store.dispatch("management/find",{type:p["x"],id:e}),a=t.data["vcdcredentialConfig-password"],i=atob(a);this.password=i,this.havePassword=!0,this.ready=!0}catch(t){this.password="",this.havePassword=!1,console.error(t)}this.$set(this,"authenticating",!0);const e=new g["a"](this.$store,this.credential);e.password=this.password,this.vcd=e,this.vcd.getToken().then(t=>{var a,i,s,o;if(t.error)return this.$set(this,"authenticating",!1),this.$emit("validationChanged",!1),void this.errors.push("Unable to authenticate with the vCloud Director server");this.$set(this,"authenticating",!1);const l=[{name:"NONE"},{name:"DHCP"},{name:"POOL"},{name:"MANUAL"}];e.setOptions(l,this.ipaddressallocationmode,"",void 0,null===(a=this.value)||void 0===a?void 0:a.ipaddressallocationmode),e.getCatalog(this.catalogs,null===(i=this.value)||void 0===i?void 0:i.catalog),e.getNetwork(this.orgvdcnetwork,null===(s=this.value)||void 0===s?void 0:s.orgvdcnetwork),e.getStorage(this.storprofile,null===(o=this.value)||void 0===o?void 0:o.storprofile)})},data(){var e,t,a,i,s,o,l,r,n,d,c;return{authenticating:!1,ready:!1,vcd:null,password:null,havePassword:!1,operatingSystem:m(),networkadaptertype:m(),catalogs:m(),catalogitem:m(),orgvdcnetwork:m(),storprofile:m(),vAppVms:m(),ipaddressallocationmode:m(),memorySize:(null===(e=this.value)||void 0===e?void 0:e.memorySize)||"4096",diskSize:(null===(t=this.value)||void 0===t?void 0:t.diskSize)||"20480",cpuCount:(null===(a=this.value)||void 0===a?void 0:a.cpuCount)||"2",sshUser:(null===(i=this.value)||void 0===i?void 0:i.sshUser)||"docker",initData:(null===(s=this.value)||void 0===s?void 0:s.initData)||null,userData:(null===(o=this.value)||void 0===o?void 0:o.userData)||null,edgegateway:(null===(l=this.value)||void 0===l?void 0:l.edgegateway)||null,vdcedgegateway:(null===(r=this.value)||void 0===r?void 0:r.vdcedgegateway)||null,publicip:(null===(n=this.value)||void 0===n?void 0:n.publicip)||null,rke2:(null===(d=this.value)||void 0===d?void 0:d.rke2)||!0,insecure:(null===(c=this.value)||void 0===c?void 0:c.insecure)||!1,errors:null}},watch:{credentialId(){this.$fetch()},"catalogs.selected":{handler(e,t){var a;this.$emit("validationChanged",!1),void 0!==e.name&&(this.vcd.getTemplate(this.catalogitem,e.name,null===(a=this.value)||void 0===a?void 0:a.catalogitem),this.$emit("validationChanged",!0))}},"catalogitem.selected":{handler(e,t){this.$emit("validationChanged",!1),void 0!==e.name&&(this.vcd.getVAppVms(this.vAppVms,e.href),this.$emit("validationChanged",!0))}},"vAppVms.selected":{handler(e,t){this.$emit("validationChanged",!1),void 0!==e.osType&&(this.vcd.getOperatingSystem(this.operatingSystem,e.hardwareVersionHref,e.osType),this.$emit("validationChanged",!0))}},"operatingSystem.selected":{handler(e,t){var a;this.$emit("validationChanged",!1),void 0!==e.name&&(this.vcd.setOptions(e,this.networkadaptertype,"supportedNICType",void 0,null===(a=this.value)||void 0===a?void 0:a.networkadaptertype),this.$emit("validationChanged",!0))}}},methods:{stringify:v["d"],initForViewMode(){var e,t,a,i,s,o;this.fakeSelectOptions(this.catalogs,null===(e=this.value)||void 0===e?void 0:e.catalog),this.fakeSelectOptions(this.catalogitem,null===(t=this.value)||void 0===t?void 0:t.catalogitem),this.fakeSelectOptions(this.orgvdcnetwork,null===(a=this.value)||void 0===a?void 0:a.orgvdcnetwork),this.fakeSelectOptions(this.storprofile,null===(i=this.value)||void 0===i?void 0:i.storprofile),this.fakeSelectOptions(this.networkadaptertype,null===(s=this.value)||void 0===s?void 0:s.networkadaptertype),this.fakeSelectOptions(this.ipaddressallocationmode,null===(o=this.value)||void 0===o?void 0:o.ipaddressallocationmode)},fakeSelectOptions(e,t){e.busy=!1,e.enabled=!1,e.options=[],t&&e.options.push({label:t,value:t}),e.selected=t},syncValue(){var e,t,a,i,s,o;this.value.catalog=null===(e=this.catalogs.selected)||void 0===e?void 0:e.name,this.value.catalogitem=null===(t=this.catalogitem.selected)||void 0===t?void 0:t.name,this.value.orgvdcnetwork=null===(a=this.orgvdcnetwork.selected)||void 0===a?void 0:a.name,this.value.storprofile=null===(i=this.storprofile.selected)||void 0===i?void 0:i.name,this.value.networkadaptertype=null===(s=this.networkadaptertype.selected)||void 0===s?void 0:s.name,this.value.ipaddressallocationmode=null===(o=this.ipaddressallocationmode.selected)||void 0===o?void 0:o.name,this.value.cpuCount=this.cpuCount,this.value.memorySize=this.memorySize,this.value.diskSize=this.diskSize,this.value.sshUser=this.sshUser,this.value.initData=this.initData,this.value.userData=this.userData,this.value.edgegateway=this.edgegateway,this.value.vdcedgegateway=this.vdcedgegateway,this.value.publicip=this.publicip,this.value.insecure=this.insecure,this.value.sshPort="22",this.value.rke2=!0},test(){this.syncValue()}}},f=b,y=(a("9b8d"),a("d802")),w=Object(y["a"])(f,i,s,!1,null,"09fd6f28",null);t["default"]=w.exports},"03ea":function(e,t,a){var i=a("5eaa");t=i(!1),t.push([e.i,".file-button[data-v-09fd6f28]{align-items:center;position:absolute;top:0;right:0;height:100%;display:flex}.file-button>.file-selector[data-v-09fd6f28]{height:59px;border-top-left-radius:0;border-bottom-left-radius:0}.vcd-config[data-v-09fd6f28]{display:flex;align-items:center}.vcd-config>.title[data-v-09fd6f28]{font-weight:700;padding:4px 0}.vcd-config>.loading[data-v-09fd6f28]{margin-left:20px;display:flex;align-items:center}.vcd-config>.loading>i[data-v-09fd6f28]{margin-right:4px}",""]),e.exports=t},7713:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var i=a("4048");function s(e,t,a){return t=o(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e){var t=l(e,"string");return"symbol"==typeof t?t:String(t)}function l(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var i=a.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}class r{constructor(e,t){s(this,"href",""),s(this,"username",""),s(this,"password",""),s(this,"org",""),s(this,"orgId",""),s(this,"version","36.0"),s(this,"vdc",""),s(this,"token",""),s(this,"$dispatch",void 0),t.annotations?Object.keys(t.annotations).forEach(e=>{const a=e.split("/");if(2===a.length&&"vcd.cattle.io"===a[0]){const i=a[1];this[i]=t.annotations[e]}}):Object.keys(t).forEach(e=>{this[e]=t[e]}),this.$dispatch=e.dispatch}protocolHostname(e){const t=Object(i["b"])(e);return(null===t||void 0===t?void 0:t.host)||""}getDeepKey(e,t){return t.replace(/\[([^\[\]]*)\]/g,".$1.").split(".").filter(e=>""!==e).reduce((e,t)=>e&&e[t],e)}async getToken(){const e=`/meta/proxy/${this.protocolHostname(this.href)}/cloudapi/1.0.0/sessions`,t={Accept:"application/*;version="+this.version,"X-API-Auth-Header":"Basic "+btoa(`${this.username}@${this.org}:${this.password}`)};try{const a=await this.$dispatch("management/request",{url:e,headers:t,method:"POST",redirectUnauthorized:!1},{root:!0});if(502===a._status)return{error:"Could not proxy request - URL may not be in Rancher's allow list"};const i=a._headers["x-vmware-vcloud-access-token"];return this.token=i,this.orgId=a.org.id.replace(/^urn:vcloud:org:/,""),a}catch(a){return console.error(a),{error:a}}}async getCatalog(e,t){return await this.getOptions(e,"/query?type=catalog&pageSize=1000","record",void 0,t)}async getTemplate(e,t,a){return await this.getOptions(e,`/query?type=vAppTemplate&pageSize=1000&filter=(catalogName==${t})`,"record",void 0,a)}async getNetwork(e,t){return await this.getOptions(e,"/cloudapi/1.0.0/orgVdcNetworks?filterEncoded=true&pageSize=20&filter=((crossVdcNetworkId==null))","values",void 0,t,!0)}async getStorage(e,t){return await this.getOptions(e,"/query?type=orgVdcStorageProfile&pageSize=1000","record",e=>{if(e.vdcName===this.vdc)return e},t)}async getVAppVms(e,t,a){return await this.getOptions(e,Object(i["b"])(t).path.replace(/^\/api/,""),"children.vm",e=>{const t=e.section.find(e=>"VmSpecSectionType"===e._type);return{...e,osType:t.osType,hardwareVersionHref:t.hardwareVersion.href}},a)}async getOperatingSystem(e,t,a){return await this.getOptions(e,Object(i["b"])(t).path.replace(/^\/api/,""),"supportedOperatingSystems.operatingSystemFamilyInfo[1].operatingSystem",e=>({...e,name:e.internalName}),a)}setOptions(e,t,a,i,s){if(e){let o=this.getDeepKey(e,a)||[];if(i&&(o=o.map(e=>i(e))),t.options=this.convertToOptions(o),t.busy=!1,s){const e=t.options.find(e=>e.value.name===s);e&&(t.selected=e.value)}!t.selected&&t.options.length>0&&(t.selected=t.options[0].value)}else t.options=[],t.selected=null,t.busy=!1,t.enabled=!1}async getOptions(e,t,a,i,s,o){var l;e.busy=!0,e.enabled=!0,e.selected="";let r=!0,n=await this.makeComputeRequest(t,o);const d=n;let c=1;if(null!==(l=n)&&void 0!==l&&l.pageCount)while(r){var u,p;(null===(u=n)||void 0===u?void 0:u.pageCount)>(null===(p=n)||void 0===p?void 0:p.page)?(c=n.page+1,n=await this.makeComputeRequest(`${t}&page=${c}`,o),d[a]=d[a].concat(n[a])):r=!1}this.setOptions(d,e,a,i,s)}async makeComputeRequest(e,t){const a=t?Object(i["b"])(this.href).host:this.href.replace(/^https?:\/\//,""),s="/meta/proxy/"+a,o=`${s}${e}`,l=t?{Accept:"application/json;multisite=global;version="+this.version,"X-API-Auth-Header":"Bearer "+this.token}:{Accept:"application/*+json;version="+this.version,"X-API-Auth-Header":"Bearer "+this.token};try{const e=await this.$dispatch("management/request",{url:o,headers:l,method:"GET",redirectUnauthorized:!1},{root:!0});return e}catch(r){console.error(r)}}async getVdcs(){const e=this.href.replace(/^https?:\/\//,""),t="/meta/proxy/"+e,a={Accept:"application/*+json;version="+this.version,"X-API-Auth-Header":"Bearer "+this.token};try{const e=await this.$dispatch("management/request",{url:`${t}/org/${this.orgId}/vdcRollup`,headers:a,method:"GET",redirectUnauthorized:!1},{root:!0});return null===e||void 0===e?void 0:e.orgVdcReference}catch(i){return console.error(i),{error:i}}}convertToOptions(e){let t=(e||[]).sort((e,t)=>e.name.localeCompare(t.name));return t=t.filter(e=>void 0!==e),t.map(e=>({label:e.name,value:e}))}}},"9b8d":function(e,t,a){"use strict";a("c9f0")},c9f0:function(e,t,a){var i=a("03ea");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var s=a("0ed3").default;s("dc0202da",i,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=vcd-node-driver-0.2.10.umd.min.machine-config.js.map