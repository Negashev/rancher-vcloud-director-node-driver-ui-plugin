(("undefined"!==typeof self?self:this)["webpackChunkvcd_node_driver_0_5_0"]=("undefined"!==typeof self?self:this)["webpackChunkvcd_node_driver_0_5_0"]||[]).push([[921],{8474:function(e,t,a){"use strict";a.r(t);var s=a(429),o=a.n(s),i=a(1214),l=a.n(i),r=l()(o());r.push([e.id,".file-button[data-v-44273b54]{align-items:center;position:absolute;top:0;right:0;height:100%;display:flex}.file-button>.file-selector[data-v-44273b54]{height:59px;border-top-left-radius:0;border-bottom-left-radius:0}.vcd-config[data-v-44273b54]{display:flex;align-items:center}.vcd-config>.title[data-v-44273b54]{font-weight:700;padding:4px 0}.vcd-config>.loading[data-v-44273b54]{margin-left:20px;display:flex;align-items:center}.vcd-config>.loading>i[data-v-44273b54]{margin-right:4px}",""]),t["default"]=r},9382:function(e,t,a){"use strict";a.d(t,{k:function(){return n}});var s=a(667),o=a(4364);function i(e,t,a){return(t=l(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e){var t=r(e,"string");return"symbol"==typeof t?t:t+""}function r(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var s=a.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}class n{constructor(e,t){i(this,"href",""),i(this,"username",""),i(this,"password",""),i(this,"org",""),i(this,"orgId",""),i(this,"version","36.0"),i(this,"vdc",""),i(this,"vappName",""),i(this,"token",""),i(this,"$dispatch",void 0),t.annotations?Object.keys(t.annotations).forEach((e=>{const a=e.split("/");if(2===a.length&&"vcd.cattle.io"===a[0]){const s=a[1];this[s]=t.annotations[e]}})):Object.keys(t).forEach((e=>{this[e]=t[e]})),this.$dispatch=e.dispatch}protocolHostname(e){const t=(0,s.qg)(e);return t?.host||""}getDeepKey(e,t){return t.replace(/\[([^\[\]]*)\]/g,".$1.").split(".").filter((e=>""!==e)).reduce(((e,t)=>e&&e[t]),e)}async getToken(){const e=`/meta/proxy/${this.protocolHostname(this.href)}/cloudapi/1.0.0/sessions`,t={Accept:`application/*;version=${this.version}`,"X-API-Auth-Header":`Basic ${btoa(`${this.username}@${this.org}:${this.password}`)}`};try{const a=await this.$dispatch("management/request",{url:e,headers:t,method:"POST",redirectUnauthorized:!1},{root:!0});if(502===a._status)return{error:"Could not proxy request - URL may not be in Rancher's allow list"};const s=a._headers["x-vmware-vcloud-access-token"];return this.token=s,this.orgId=a.org.id.replace(/^urn:vcloud:org:/,""),a}catch(a){return o.error(a),{error:a}}}async getCatalog(e,t){return await this.getOptions(e,"/query?type=catalog&pageSize=1000","record",void 0,t)}async getTemplate(e,t,a){return await this.getOptions(e,`/query?type=vAppTemplate&pageSize=1000&filter=(catalogName==${t})`,"record",void 0,a)}async getNetwork(e,t){return await this.getOptions(e,"/cloudapi/1.0.0/orgVdcNetworks?filterEncoded=true&pageSize=20&filter=((crossVdcNetworkId==null))","values",void 0,t,!0)}async getStorage(e,t){return await this.getOptions(e,"/query?type=orgVdcStorageProfile&pageSize=1000","record",(e=>{if(e.vdcName===this.vdc)return e}),t)}async getVAppVms(e,t,a){return await this.getOptions(e,(0,s.qg)(t).path.replace(/^\/api/,""),"children.vm",(e=>{const t=e.section.find((e=>"VmSpecSectionType"===e._type));return{...e,osType:t.osType,hardwareVersionHref:t.hardwareVersion.href}}),a)}async getOperatingSystem(e,t,a){return await this.getOptions(e,(0,s.qg)(t).path.replace(/^\/api/,""),"supportedOperatingSystems.operatingSystemFamilyInfo[1].operatingSystem",(e=>({...e,name:e.internalName})),a)}setOptions(e,t,a,s,o){if(e){let i=this.getDeepKey(e,a)||[];if(s&&(i=i.map((e=>s(e)))),t.options=this.convertToOptions(i),t.busy=!1,o){const e=t.options.find((e=>e.value.name===o));e&&(t.selected=e.value)}!t.selected&&t.options.length>0&&(t.selected=t.options[0].value)}else t.options=[],t.selected=null,t.busy=!1,t.enabled=!1}async getOptions(e,t,a,s,o,i){e.busy=!0,e.enabled=!0,e.selected="";let l=!0,r=await this.makeComputeRequest(t,i);const n=r;let d=1;if(r?.pageCount)while(l)r?.pageCount>r?.page?(d=r.page+1,r=await this.makeComputeRequest(`${t}&page=${d}`,i),n[a]=n[a].concat(r[a])):l=!1;this.setOptions(n,e,a,s,o)}async makeComputeRequest(e,t){const a=t?(0,s.qg)(this.href).host:this.href.replace(/^https?:\/\//,""),i=`/meta/proxy/${a}`,l=`${i}${e}`,r=t?{Accept:`application/json;multisite=global;version=${this.version}`,"X-API-Auth-Header":`Bearer ${this.token}`}:{Accept:`application/*+json;version=${this.version}`,"X-API-Auth-Header":`Bearer ${this.token}`};try{const e=await this.$dispatch("management/request",{url:l,headers:r,method:"GET",redirectUnauthorized:!1},{root:!0});return e}catch(n){o.error(n)}}async getVdcs(){const e=this.href.replace(/^https?:\/\//,""),t=`/meta/proxy/${e}`,a={Accept:`application/*+json;version=${this.version}`,"X-API-Auth-Header":`Bearer ${this.token}`};try{const e=await this.$dispatch("management/request",{url:`${t}/org/${this.orgId}/vdcRollup`,headers:a,method:"GET",redirectUnauthorized:!1},{root:!0});return e?.orgVdcReference}catch(s){return o.error(s),{error:s}}}async getVApps(){const e=this.href.replace(/^https?:\/\//,""),t=`/meta/proxy/${e}`,a={Accept:`application/*+json;version=${this.version}`,"X-API-Auth-Header":`Bearer ${this.token}`};try{const e=await this.$dispatch("management/request",{url:`${t}/query?type=vApp&pageSize=1000`,headers:a,method:"GET",redirectUnauthorized:!1},{root:!0});return e?.record}catch(s){return o.error(s),{error:s}}}convertToOptions(e){let t=(e||[]).sort(((e,t)=>e.name.localeCompare(t.name)));return t=t.filter((e=>void 0!==e)),t.map((e=>({label:e.name,value:e})))}}},9246:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ie}});var s=a(9274);const o=e=>((0,s.pushScopeId)("data-v-44273b54"),e=e(),(0,s.popScopeId)(),e),i={key:1},l={class:"vcd-config"},r=o((()=>(0,s.createElementVNode)("div",{class:"title"}," vCloud Director Configuration ",-1))),n={key:0,class:"loading"},d=o((()=>(0,s.createElementVNode)("i",{class:"icon-spinner icon-spin icon-lg"},null,-1))),c=o((()=>(0,s.createElementVNode)("span",null," Authenticating with the vCloud Director server ... ",-1))),p=[d,c],u={class:"row mt-10"},h={class:"col span-6"},v={class:"col span-6"},m={class:"row mt-10"},g={class:"col span-6"},b={class:"col span-6"},y={class:"row mt-10"},f={class:"col span-6"},w={class:"row mt-10"},k={class:"col span-6"},N={class:"row mt-10"},V={class:"col span-6"},S={class:"row mt-10"},C={class:"col span-6"},E={class:"row mt-10"},$={class:"col span-6"},A={class:"row mt-10"},U={class:"col span-6"},O={class:"row mt-10"},I={class:"col span-6"},B={class:"col span-6"},q=o((()=>(0,s.createElementVNode)("br",null,null,-1))),D={class:"row mt-10"},z={class:"col span-6"},x={class:"col span-6"},P={class:"row mt-10"},T={class:"col span-6"},_={class:"col span-6"},L={class:"row mt-10"},H={class:"col span-6"};function j(e,t,a,o,d,c){const j=(0,s.resolveComponent)("Loading"),M=(0,s.resolveComponent)("Banner"),R=(0,s.resolveComponent)("LabeledSelect"),G=(0,s.resolveComponent)("UnitInput"),X=(0,s.resolveComponent)("LabeledInput"),F=(0,s.resolveComponent)("Checkbox");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[e.$fetchState.pending?((0,s.openBlock)(),(0,s.createBlock)(j,{key:0,delayed:!0})):(0,s.createCommentVNode)("",!0),d.errors.length?((0,s.openBlock)(),(0,s.createElementBlock)("div",i,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(d.errors,((e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:t},[(0,s.createVNode)(M,{color:"error",label:c.stringify(e)},null,8,["label"])])))),128))])):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("div",null,[(0,s.createElementVNode)("div",l,[r,d.authenticating?((0,s.openBlock)(),(0,s.createElementBlock)("div",n,p)):(0,s.createCommentVNode)("",!0)]),(0,s.createElementVNode)("div",u,[(0,s.createElementVNode)("div",h,[(0,s.createVNode)(R,{value:d.catalogs.selected,"onUpdate:value":t[0]||(t[0]=e=>d.catalogs.selected=e),label:"Catalog",options:d.catalogs.options,disabled:!d.catalogs.enabled||a.busy,loading:d.catalogs.busy,searchable:!1},null,8,["value","options","disabled","loading"])]),(0,s.createElementVNode)("div",v,[(0,s.createVNode)(R,{value:d.catalogitem.selected,"onUpdate:value":t[1]||(t[1]=e=>d.catalogitem.selected=e),label:"vApp template",options:d.catalogitem.options,disabled:!d.catalogs.enabled&&!d.catalogitem.enabled,loading:d.catalogitem.busy||d.catalogs.busy||a.busy,searchable:!1},null,8,["value","options","disabled","loading"])])]),(0,s.createElementVNode)("div",m,[(0,s.createElementVNode)("div",g,[(0,s.createVNode)(R,{value:d.orgvdcnetwork.selected,"onUpdate:value":t[2]||(t[2]=e=>d.orgvdcnetwork.selected=e),label:"Network",options:d.orgvdcnetwork.options,disabled:!d.orgvdcnetwork.enabled||a.busy,loading:d.orgvdcnetwork.busy,searchable:!1},null,8,["value","options","disabled","loading"])]),(0,s.createElementVNode)("div",b,[(0,s.createVNode)(R,{value:d.networkadaptertype.selected,"onUpdate:value":t[3]||(t[3]=e=>d.networkadaptertype.selected=e),label:"Network Adapter",options:d.networkadaptertype.options,disabled:!d.catalogitem.enabled&&!d.networkadaptertype.enabled&&!d.vAppVms.enabled&&!d.operatingSystem.enabled,loading:d.networkadaptertype.busy||d.catalogitem.busy||d.vAppVms.busy||d.operatingSystem.busy||a.busy,searchable:!1},null,8,["value","options","disabled","loading"])])]),(0,s.createElementVNode)("div",y,[(0,s.createElementVNode)("div",f,[(0,s.createVNode)(R,{value:d.ipaddressallocationmode.selected,"onUpdate:value":t[4]||(t[4]=e=>d.ipaddressallocationmode.selected=e),label:"IP Address Allocation Mode",options:d.ipaddressallocationmode.options,disabled:a.busy,searchable:!1},null,8,["value","options","disabled"])])]),(0,s.createElementVNode)("div",w,[(0,s.createElementVNode)("div",k,[(0,s.createVNode)(R,{value:d.storprofile.selected,"onUpdate:value":t[5]||(t[5]=e=>d.storprofile.selected=e),label:"Storage",options:d.storprofile.options,disabled:!d.storprofile.enabled||a.busy,loading:d.storprofile.busy,searchable:!1},null,8,["value","options","disabled","loading"])])]),(0,s.createElementVNode)("div",N,[(0,s.createElementVNode)("div",V,[(0,s.createVNode)(G,{value:d.cpuCount,"onUpdate:value":t[6]||(t[6]=e=>d.cpuCount=e),mode:e.mode,disabled:a.busy,required:!0,"output-as":"string",label:"CPU",suffix:"Cores"},null,8,["value","mode","disabled"])])]),(0,s.createElementVNode)("div",S,[(0,s.createElementVNode)("div",C,[(0,s.createVNode)(G,{value:d.memorySize,"onUpdate:value":t[7]||(t[7]=e=>d.memorySize=e),mode:e.mode,disabled:a.busy,required:!0,"output-as":"string",label:"Memory",suffix:"MB"},null,8,["value","mode","disabled"])])]),(0,s.createElementVNode)("div",E,[(0,s.createElementVNode)("div",$,[(0,s.createVNode)(G,{value:d.diskSize,"onUpdate:value":t[8]||(t[8]=e=>d.diskSize=e),mode:e.mode,disabled:a.busy,required:!0,"output-as":"string",label:"Disk size",suffix:"MB"},null,8,["value","mode","disabled"])])]),(0,s.createElementVNode)("div",A,[(0,s.createElementVNode)("div",U,[(0,s.createVNode)(X,{value:d.sshUser,"onUpdate:value":t[9]||(t[9]=e=>d.sshUser=e),mode:e.mode,disabled:a.busy,required:!0,label:"SSH User"},null,8,["value","mode","disabled"])])]),(0,s.createElementVNode)("div",O,[(0,s.createElementVNode)("div",I,[(0,s.createVNode)(X,{value:d.initData,"onUpdate:value":t[10]||(t[10]=e=>d.initData=e),mode:e.mode,disabled:a.busy,label:"Cloud-init based User data before everything"},null,8,["value","mode","disabled"])]),(0,s.createElementVNode)("div",B,[(0,s.createVNode)(X,{value:d.userData,"onUpdate:value":t[11]||(t[11]=e=>d.userData=e),mode:e.mode,disabled:a.busy,label:"Cloud-init based User data"},null,8,["value","mode","disabled"])])]),q,(0,s.createElementVNode)("div",D,[(0,s.createElementVNode)("div",z,[(0,s.createVNode)(X,{value:d.edgegateway,"onUpdate:value":t[12]||(t[12]=e=>d.edgegateway=e),mode:e.mode,disabled:a.busy,label:"Edge Gateway (Default is <vdc>)"},null,8,["value","mode","disabled"])]),(0,s.createElementVNode)("div",x,[(0,s.createVNode)(X,{value:d.vdcedgegateway,"onUpdate:value":t[13]||(t[13]=e=>d.vdcedgegateway=e),mode:e.mode,disabled:a.busy,label:"Virtual Data Center Edge Gateway"},null,8,["value","mode","disabled"])])]),(0,s.createElementVNode)("div",P,[(0,s.createElementVNode)("div",T,[(0,s.createVNode)(X,{value:d.publicip,"onUpdate:value":t[14]||(t[14]=e=>d.publicip=e),mode:e.mode,disabled:a.busy,label:"Public IP to use"},null,8,["value","mode","disabled"])]),(0,s.createElementVNode)("div",_,[(0,s.createVNode)(X,{value:d.vappName,"onUpdate:value":t[15]||(t[15]=e=>d.vappName=e),mode:e.mode,disabled:!0,label:"vApp"},null,8,["value","mode"])])]),(0,s.createElementVNode)("div",L,[(0,s.createElementVNode)("div",H,[(0,s.createVNode)(F,{value:d.insecure,"onUpdate:value":t[16]||(t[16]=e=>d.insecure=e),mode:e.mode,disabled:a.busy,label:"Insecure api"},null,8,["value","mode","disabled"])])])])])}var M=a(9822),R=a(9980),G=a(6414),X=a(4248),F=a(4134),K=a(2635),W=a(7229),J=a(5664),Q=a(9726),Y=a(4220),Z=a(9382),ee=a(4364);function te(){return{options:[],selected:null,busy:!1,enabled:!1}}var ae={components:{Banner:R.l,Loading:M.A,LabeledInput:W.o,UnitInput:F.A,LabeledSelect:X.A,Checkbox:K.A},mixins:[G.A],props:{uuid:{type:String,required:!0},cluster:{type:Object,default:()=>({})},credentialId:{type:String,required:!0},disabled:{type:Boolean,default:!1},busy:{type:Boolean,default:!1},provider:{type:String,required:!0}},async fetch(){if(this.errors=[],!this.credentialId)return;if(this.mode===Y.nW)return void this.initForViewMode();try{this.credential=await this.$store.dispatch("rancher/find",{type:J.k$.CLOUD_CREDENTIAL,id:this.credentialId})}catch(t){this.credential=null}try{const e=this.credentialId.replace(":","/"),t=await this.$store.dispatch("management/find",{type:J.bB,id:e}),a=t.data["vcdcredentialConfig-password"],s=atob(a);this.password=s,this.havePassword=!0,this.ready=!0}catch(t){this.password="",this.havePassword=!1,ee.error(t)}this["authenticating"]=!0;const e=new Z.k(this.$store,this.credential);e.password=this.password,this.vcd=e,this.vcd.getToken().then((t=>{if(t.error)return this["authenticating"]=!1,this.$emit("validationChanged",!1),void this.errors.push("Unable to authenticate with the vCloud Director server");this["authenticating"]=!1;const a=[{name:"NONE"},{name:"DHCP"},{name:"POOL"},{name:"MANUAL"}];e.setOptions(a,this.ipaddressallocationmode,"",void 0,this.value?.ipaddressallocationmode),e.getCatalog(this.catalogs,this.value?.catalog),e.getNetwork(this.orgvdcnetwork,this.value?.orgvdcnetwork),e.getStorage(this.storprofile,this.value?.storprofile),this["vappName"]=this.vappName||e.vappName}))},data(){return{authenticating:!1,ready:!1,vcd:null,password:null,havePassword:!1,operatingSystem:te(),networkadaptertype:te(),catalogs:te(),catalogitem:te(),orgvdcnetwork:te(),storprofile:te(),vAppVms:te(),ipaddressallocationmode:te(),memorySize:this.value?.memorySize||"4096",diskSize:this.value?.diskSize||"20480",cpuCount:this.value?.cpuCount||"2",sshUser:this.value?.sshUser||"docker",initData:this.value?.initData||null,userData:this.value?.userData||null,edgegateway:this.value?.edgegateway||null,vdcedgegateway:this.value?.vdcedgegateway||null,publicip:this.value?.publicip||null,rke2:this.value?.rke2||!0,insecure:this.value?.insecure||!1,vappName:this.value?.vappName,errors:null}},watch:{credentialId(){this.$fetch()},"catalogs.selected":{handler(e,t){this.$emit("validationChanged",!1),void 0!==e.name&&(this.vcd.getTemplate(this.catalogitem,e.name,this.value?.catalogitem),this.$emit("validationChanged",!0))}},"catalogitem.selected":{handler(e,t){this.$emit("validationChanged",!1),void 0!==e.name&&(this.vcd.getVAppVms(this.vAppVms,e.href),this.$emit("validationChanged",!0))}},"vAppVms.selected":{handler(e,t){this.$emit("validationChanged",!1),void 0!==e.osType&&(this.vcd.getOperatingSystem(this.operatingSystem,e.hardwareVersionHref,e.osType),this.$emit("validationChanged",!0))}},"operatingSystem.selected":{handler(e,t){this.$emit("validationChanged",!1),void 0!==e.name&&(this.vcd.setOptions(e,this.networkadaptertype,"supportedNICType",void 0,this.value?.networkadaptertype),this.$emit("validationChanged",!0))}}},methods:{stringify:Q.As,initForViewMode(){this.fakeSelectOptions(this.catalogs,this.value?.catalog),this.fakeSelectOptions(this.catalogitem,this.value?.catalogitem),this.fakeSelectOptions(this.orgvdcnetwork,this.value?.orgvdcnetwork),this.fakeSelectOptions(this.storprofile,this.value?.storprofile),this.fakeSelectOptions(this.networkadaptertype,this.value?.networkadaptertype),this.fakeSelectOptions(this.ipaddressallocationmode,this.value?.ipaddressallocationmode)},fakeSelectOptions(e,t){e.busy=!1,e.enabled=!1,e.options=[],t&&e.options.push({label:t,value:t}),e.selected=t},syncValue(){this.value.catalog=this.catalogs.selected?.name,this.value.catalogitem=this.catalogitem.selected?.name,this.value.orgvdcnetwork=this.orgvdcnetwork.selected?.name,this.value.storprofile=this.storprofile.selected?.name,this.value.networkadaptertype=this.networkadaptertype.selected?.name,this.value.ipaddressallocationmode=this.ipaddressallocationmode.selected?.name,this.value.cpuCount=this.cpuCount,this.value.memorySize=this.memorySize,this.value.diskSize=this.diskSize,this.value.sshUser=this.sshUser,this.value.initData=this.initData,this.value.userData=this.userData,this.value.edgegateway=this.edgegateway,this.value.vdcedgegateway=this.vdcedgegateway,this.value.publicip=this.publicip,this.value.insecure=this.insecure,this.value.vappName=this.vappName,this.value.sshPort="22",this.value.rke2=!0},test(){this.syncValue()}}},se=(a(6925),a(7433));const oe=(0,se.A)(ae,[["render",j],["__scopeId","data-v-44273b54"]]);var ie=oe},6925:function(e,t,a){var s=a(8474);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(4825).A;o("2880522d",s,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=vcd-node-driver-0.5.0.umd.min.machine-config.js.map